{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container">
    <header class="main-header">
        <h1>User Management</h1>
        <button id="create-user-modal-btn" class="btn-primary">Create New User</button>
    </header>

    <div class="document-grid">
        {% for user in users %}
        <div class="user-card">
            <div class="user-card-header">
                <h3>{{ user.username }}</h3>
                <span class="user-card-role {% if user.role == 'admin' %}admin{% endif %}">{{ user.role }}</span>
            </div>
            <p>{{ user.email }}</p>
            <div class="user-card-actions">
              <button class="edit-user-btn"
        data-user-id="{{ user.id }}"
        data-username="{{ user.username }}"
        data-email="{{ user.email }}"
        data-role="{{ user.role }}">Edit</button>
                <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this user? This cannot be undone.');">
                    <button type="submit" class="btn-danger">Delete</button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div id="create-user-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Create New User</h2>
        <form action="{{ url_for('admin.create_user') }}" method="POST" class="form-container">
            <div class="form-group">
                <label for="create-username">Username</label>
                <input type="text" id="create-username" name="username" required>
            </div>
            <div class="form-group">
                <label for="create-email">Email</label>
                <input type="email" id="create-email" name="email" required>
            </div>
            <div class="form-group">
                <label for="create-password">Password</label>
                <input type="password" id="create-password" name="password" required>
            </div>
            <div class="form-group">
                <label for="create-role">Role</label>
                <select id="create-role" name="role">
                    <option value="user" selected>User</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <button type="submit" class="btn-primary">Create User</button>
        </form>
    </div>
</div>

<div id="edit-user-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Edit User</h2>
        <form id="edit-user-form" method="POST" class="form-container">
            <div class="form-group">
                <label for="edit-username">Username</label>
                <input type="text" id="edit-username" name="username" required>
            </div>
            <div class="form-group">
                <label for="edit-email">Email</label>
                <input type="email" id="edit-email" name="email" required>
            </div>
            <div class="form-group">
                <label for="edit-password">New Password (optional)</label>
                <input type="password" id="edit-password" name="password" placeholder="Leave blank to keep current password">
            </div>
            <div class="form-group">
                <label for="edit-role">Role</label>
                <select id="edit-role" name="role">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            <button type="submit" class="btn-primary">Save Changes</button>
        </form>
    </div>
</div>
{% endblock %}